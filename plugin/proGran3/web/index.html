<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>proGran3 Конструктор</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="glass-container" id="main-content">
    <header>
      <!-- Лівий верхній кут - вибір одиниць -->
      <div class="header-left">
        <div class="unit-switcher">
          <div class="unit-toggle">
            <input type="radio" id="unit-mm" name="unit" value="mm" checked onchange="changeUnit('mm')">
            <input type="radio" id="unit-cm" name="unit" value="cm" onchange="changeUnit('cm')">
            <label for="unit-mm" class="unit-label" onclick="changeUnit('mm')" data-i18n="units.mm">мм</label>
            <label for="unit-cm" class="unit-label" onclick="changeUnit('cm')" data-i18n="units.cm">см</label>
            <div class="unit-slider"></div>
          </div>
        </div>
      </div>
      
      <!-- Центр - заголовок -->
      <div class="header-center">
        <h1 onclick="toggleTheme()" style="cursor: pointer;">ProGran</h1>
      </div>
      
      <!-- Правий верхній кут - вибір мови -->
      <div class="header-right">
        <!-- Перемикач мов буде додано через JavaScript -->
      </div>
    </header>

    <!-- Карточка блокування (показується коли плагін заблокований) -->
    <div id="blocking-card" class="blocking-card" style="display: none;">
      <div class="blocking-content">
        <div class="blocking-icon">⚠️</div>
        <h2 class="blocking-title">Потрібна активація</h2>
        <p class="blocking-message">Для продовження роботи з плагіном необхідно активувати ліцензію або перевірити підключення до інтернету</p>
        <div class="blocking-actions">
          <button onclick="openPurchasePage()" class="blocking-btn primary">Активувати ліцензію</button>
          <button onclick="retryConnection()" class="blocking-btn secondary">Перевірити підключення</button>
        </div>
      </div>
    </div>

    <!-- Навігація табів -->
    <div class="tabs-navigation">
      <button class="tab-button active" data-tab="base" data-i18n="tabs.base">База</button>
      <button class="tab-button" data-tab="monument" data-i18n="tabs.monument">Памятник</button>
      <button class="tab-button" data-tab="gravestone" data-i18n="tabs.gravestone">Надгробна частина</button>
      <button class="tab-button" data-tab="fence" data-i18n="tabs.fence">Огорожа</button>
      <button class="tab-button" data-tab="view" data-i18n="tabs.view">Вигляд</button>
    </div>

    <!-- Таб "База" -->
    <div class="tab-content active" id="base-tab">
      <section class="panel">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.foundation">Фундамент</h2>
          <span class="chevron"></span>
          <span id="foundation-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <div class="input-row">
            <div class="input-wrapper">
              <label id="foundation-depth-label" for="foundation-depth" data-i18n="dimensions.length">Довжина (мм)</label>
              <input type="number" id="foundation-depth" value="2000" oninput="updateAllDisplays()">
            </div>
            <div class="input-wrapper">
              <label id="foundation-width-label" for="foundation-width" data-i18n="dimensions.width">Ширина (мм)</label>
              <input type="number" id="foundation-width" value="1000" oninput="updateAllDisplays()">
            </div>
            <div class="input-wrapper">
              <label id="foundation-height-label" for="foundation-height" data-i18n="dimensions.height">Висота (мм)</label>
              <input type="number" id="foundation-height" value="150" oninput="updateAllDisplays()">
            </div>
          </div>
          <button onclick="addFoundation(); advanceToNextPanel(this);" data-i18n="buttons.create_foundation">Створити фундамент</button>
        </div>
      </section>

      <section class="panel collapsed">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.blind_area">Відмостка</h2>
          <span class="chevron"></span>
          <span id="blind-area-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <!-- Перемикач різної ширини -->
          <div class="toggle-with-label">
            <span class="toggle-label-text" data-i18n="labels.custom_width_mode">Різна ширина</span>
            <label class="modern-toggle">
              <input type="checkbox" id="blind-area-custom-mode" onchange="toggleBlindAreaCustomMode(this)">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <!-- Ширина і товщина в один ряд -->
          <div class="input-row">
            <div class="input-wrapper">
              <label id="blind-area-thickness-label" data-i18n="labels.thickness_mm">Товщина (мм)</label>
              <input type="number" id="blind-area-thickness" value="50" min="30" max="200" oninput="updateAllDisplays()">
            </div>
            <div class="input-wrapper">
              <label id="blind-area-uniform-width-label" data-i18n="labels.width_mm">Ширина (мм)</label>
              <input type="number" id="blind-area-uniform-width" value="300" min="50" max="1000" oninput="updateAllDisplays()">
            </div>
          </div>
          
          <div id="blind-area-uniform-controls">
            <!-- Порожній блок для однакової ширини (вже є в ряді вище) -->
          </div>
          
          <div id="blind-area-custom-controls" class="hidden">
            <div class="input-row">
              <div class="input-wrapper">
                <label id="blind-area-north-label" data-i18n="labels.north_side_mm">Північна сторона (мм)</label>
                <input type="number" id="blind-area-north" value="300" min="50" max="1000" oninput="updateAllDisplays()">
              </div>
              <div class="input-wrapper">
                <label id="blind-area-south-label" data-i18n="labels.south_side_mm">Південна сторона (мм)</label>
                <input type="number" id="blind-area-south" value="300" min="50" max="1000" oninput="updateAllDisplays()">
              </div>
            </div>
            
            <div class="input-row">
              <div class="input-wrapper">
                <label id="blind-area-east-label" data-i18n="labels.east_side_mm">Східна сторона (мм)</label>
                <input type="number" id="blind-area-east" value="300" min="50" max="1000" oninput="updateAllDisplays()">
              </div>
              <div class="input-wrapper">
                <label id="blind-area-west-label" data-i18n="labels.west_side_mm">Західна сторона (мм)</label>
                <input type="number" id="blind-area-west" value="300" min="50" max="1000" oninput="updateAllDisplays()">
              </div>
            </div>
          </div>
          
          <button onclick="addBlindArea(); advanceToNextPanel(this);" data-i18n="buttons.create_blind_area">Створити відмостку</button>
        </div>
      </section>

      <section class="panel collapsed">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.tiling">Плитка на фундаменті</h2>
          <span class="chevron"></span>
          <span id="tiling-type-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <div>
            <label class="label-left" data-i18n="labels.laying_method">Спосіб укладання:</label>
            <div class="button-group-tiling-mode">
              <button type="button" class="tiling-mode-btn active" data-value="modular" onclick="selectTilingMode(this)" data-i18n="buttons.modular_tiling">Модульне замощення</button>
              <button type="button" class="tiling-mode-btn" data-value="frame" onclick="selectTilingMode(this)" data-i18n="buttons.frame_4_parts">Рамка з 4 частин</button>
            </div>
          </div>
          <div id="frame-controls" class="hidden">
            <div class="input-row">
              <div class="input-wrapper">
                <label id="tile-border-width-label" for="tile-border-width" data-i18n="labels.frame_width_mm">Ширина рамки (мм)</label>
                <input type="number" id="tile-border-width" value="300" min="10" oninput="updateAllDisplays()">
              </div>
              <div class="input-wrapper">
                <label id="tile-overhang-label" for="tile-overhang" data-i18n="labels.overhang_mm">Виступ (мм)</label>
                <input type="number" id="tile-overhang" value="50" oninput="updateAllDisplays()">
              </div>
            </div>
            
            <div class="input-row">
              <div class="input-wrapper">
                <label id="frame-seam-label" data-i18n="labels.seam">Шов між плитками</label>
                <div class="button-group-seam">
                  <button type="button" class="seam-btn active" data-value="2" onclick="selectSeam(this)" data-i18n="buttons.seam_2mm">2 мм</button>
                  <button type="button" class="seam-btn" data-value="3" onclick="selectSeam(this)" data-i18n="buttons.seam_3mm">3 мм</button>
                  <button type="button" class="seam-btn" data-value="4" onclick="selectSeam(this)" data-i18n="buttons.seam_4mm">4 мм</button>
                  <button type="button" class="seam-btn" data-value="5" onclick="selectSeam(this)" data-i18n="buttons.seam_5mm">5 мм</button>
                </div>
              </div>
            </div>
            
            <div class="input-row">
              <div class="input-wrapper">
                <label id="tile-thickness-frame-label" data-i18n="labels.thickness">Товщина</label>
                <div class="button-group-thickness">
                  <button type="button" class="thickness-btn" data-value="20" onclick="selectThickness(this)" data-i18n="buttons.thickness_2cm">2 см</button>
                  <button type="button" class="thickness-btn active" data-value="30" onclick="selectThickness(this)" data-i18n="buttons.thickness_3cm">3 см</button>
                  <button type="button" class="thickness-btn" data-value="40" onclick="selectThickness(this)" data-i18n="buttons.thickness_4cm">4 см</button>
                  <button type="button" class="thickness-btn" data-value="50" onclick="selectThickness(this)" data-i18n="buttons.thickness_5cm">5 см</button>
                </div>
              </div>
            </div>
          </div>
          <div id="modular-controls">
            <div class="input-row">
              <div class="input-wrapper">
                <label for="modular-tile-size" data-i18n="labels.size_cm">Розмір (см)</label>
                <select id="modular-tile-size" onchange="updateAllDisplays()">
                  <option value="80x40">80 x 40</option>
                  <option value="70x40">70 x 40</option>
                  <option value="60x40">60 x 40</option>
                  <option value="50x40">50 x 40</option>
                  <option value="40x40">40 x 40</option>
                  <option value="60x30">60 x 30</option>
                  <option value="50x30">50 x 30</option>
                  <option value="40x30">40 x 30</option>
                  <option value="30x30">30 x 30</option>
                  <option value="80x30">80 x 30</option>
                  <option value="70x30">70 x 30</option>
                </select>
              </div>
              <div class="input-wrapper">
                <label for="modular-thickness" id="modular-thickness-label" data-i18n="labels.thickness_mm">Товщина (мм)</label>
                <input type="number" id="modular-thickness" value="30" oninput="updateAllDisplays()">
              </div>
              <div class="input-wrapper">
                <label for="modular-overhang" id="modular-overhang-label" data-i18n="labels.overhang_mm">Виступ (мм)</label>
                <input type="number" id="modular-overhang" value="50" oninput="updateAllDisplays()">
              </div>
            </div>
            
            <div class="input-row">
              <div class="input-wrapper">
                <label id="modular-seam-label" data-i18n="labels.seam">Шов</label>
                <div class="button-group-seam">
                  <button type="button" class="seam-btn active" data-value="2" onclick="selectSeam(this)" data-i18n="buttons.seam_2mm">2 мм</button>
                  <button type="button" class="seam-btn" data-value="3" onclick="selectSeam(this)" data-i18n="buttons.seam_3mm">3 мм</button>
                  <button type="button" class="seam-btn" data-value="4" onclick="selectSeam(this)" data-i18n="buttons.seam_4mm">4 мм</button>
                  <button type="button" class="seam-btn" data-value="5" onclick="selectSeam(this)" data-i18n="buttons.seam_5mm">5 мм</button>
                </div>
              </div>
            </div>
          </div>
          <button onclick="addTiles(); advanceToNextPanel(this);" data-i18n="buttons.add_tiles">Додати плитку</button>
        </div>
      </section>

      <section class="panel collapsed">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.cladding">Бокове облицювання</h2>
          <span class="chevron"></span>
          <span id="cladding-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <div class="input-row">
            <div class="input-wrapper">
              <label id="cladding-thickness-label" for="cladding-thickness" data-i18n="labels.thickness_mm">Товщина (мм)</label>
              <input type="number" id="cladding-thickness" value="20" min="10" oninput="updateAllDisplays()">
            </div>
          </div>
          <button onclick="addSideCladding(); advanceToNextPanel(this);" data-i18n="buttons.add_cladding">Додати</button>
        </div>
      </section>
    </div>

    <!-- Таб "Памятник" -->
    <div class="tab-content" id="monument-tab">
      <section class="panel">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.stands">Підставка</h2>
          <span class="chevron"></span>
          <span id="stands-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <!-- Налаштування розмірів підставки -->
          <div class="input-group">
            <div class="input-row">
              <div class="input-wrapper">
                <label id="stands-depth-label" for="stands-depth" data-i18n="labels.depth_mm">Довжина (мм)</label>
                <input type="number" id="stands-depth" value="600" min="100" max="2000" oninput="updateStandsDisplay()">
              </div>
              <div class="input-wrapper">
                <label id="stands-width-label" for="stands-width" data-i18n="labels.width_mm">Ширина (мм)</label>
                <input type="number" id="stands-width" value="150" min="100" max="1500" oninput="updateStandsDisplay()">
              </div>
              <div class="input-wrapper">
                <label id="stands-height-label" for="stands-height" data-i18n="labels.height_mm">Висота (мм)</label>
                <input type="number" id="stands-height" value="200" min="50" max="1000" oninput="updateStandsDisplay()">
              </div>
            </div>
          </div>
          
          <!-- Вмикач проміжки -->
          <div class="input-group">
            <div class="gaps-toggle">
              <label class="toggle-label">
                <input type="checkbox" id="stands-gaps" onchange="updateStandsGaps()">
                <span data-i18n="stands.gaps">Проміжка</span>
              </label>
            </div>
          </div>
          
          <!-- Розміри проміжків (показуються тільки коли увімкнено проміжки) -->
          <div class="input-group" id="gaps-dimensions-group" style="display: none;">
            <div class="input-row">
              <div class="input-wrapper">
                <label id="gaps-depth-label" for="gaps-depth" data-i18n="labels.gaps_depth_mm">Довжина проміжки (мм)</label>
                <input type="number" id="gaps-depth" value="650" min="100" max="2000" oninput="updateGapsDisplay()">
              </div>
              <div class="input-wrapper">
                <label id="gaps-width-label" for="gaps-width" data-i18n="labels.gaps_width_mm">Ширина проміжки (мм)</label>
                <input type="number" id="gaps-width" value="200" min="100" max="1500" oninput="updateGapsDisplay()">
              </div>
              <div class="input-wrapper">
                <label id="gaps-height-label" for="gaps-height" data-i18n="labels.gaps_height_mm">Висота проміжки (мм)</label>
                <input type="number" id="gaps-height" value="50" min="10" max="1000" oninput="updateGapsDisplay()">
              </div>
            </div>
          </div>
          
          <button onclick="addStandWithCustomSize(); advanceToNextPanel(this);" data-i18n="buttons.add_stand">Додати підставку</button>
        </div>
      </section>
      
      <section class="panel collapsed">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.steles">Стела</h2>
          <span class="chevron"></span>
          <span id="steles-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <!-- Секція 1: Тип стели -->
          <div class="stele-section">
            <div class="section-header">
              <h3 class="section-title" data-i18n="stele.type_title">Тип стели</h3>
            </div>
            <div class="segmented-control">
              <button type="button" class="segment active" data-value="single" onclick="selectSteleType(this)">
                <span data-i18n="stele.single">Одна</span>
              </button>
              <button type="button" class="segment" data-value="paired" onclick="selectSteleType(this)">
                <span data-i18n="stele.paired">Парні</span>
              </button>
            </div>
          </div>
          
          <!-- Секція 2: Вибір моделі -->
          <div class="stele-section" id="stele-model-section">
            <div class="section-header" onclick="toggleSteleModelSection(this)">
              <h3 class="section-title" data-i18n="stele.model_title">Модель стели</h3>
              <span class="chevron"></span>
            </div>
            <div class="carousel-container">
              <div class="carousel-viewport" id="steles-carousel-viewport">
                <div class="carousel-track" id="steles-carousel-track"></div>
              </div>
            </div>
            <button class="primary-btn" onclick="addModel('steles'); advanceToNextPanel(this);" data-i18n="buttons.add_stele">Додати стелу</button>
          </div>
          
          <!-- Секція 3: Масштабування стели (тільки для однієї стели) -->
          <div class="stele-section conditional" id="stele-scaling-section" style="display: none;">
            <div class="input-card">
              <h4 class="input-card-title" data-i18n="stele.scaling_title">Масштабування стели</h4>
              
              <!-- Ширина стели -->
              <div class="label-with-input">
                <label id="stele-width-label" for="stele-width" data-i18n="stele.width">Ширина стели</label>
                <input type="number" id="stele-width" value="100" min="10" max="1000" step="1" oninput="updateSteleScaling()">
              </div>
              
              <!-- Висота стели -->
              <div class="label-with-input">
                <label id="stele-height-label" for="stele-height" data-i18n="stele.height">Висота стели</label>
                <input type="number" id="stele-height" value="200" min="10" max="2000" step="1" oninput="updateSteleScaling()">
              </div>
              
              <!-- Глибина стели -->
              <div class="label-with-input">
                <label id="stele-depth-label" for="stele-depth" data-i18n="stele.depth">Глибина стели</label>
                <input type="number" id="stele-depth" value="50" min="5" max="500" step="1" oninput="updateSteleScaling()">
              </div>
              
              <!-- Кнопка застосування масштабування -->
              <button class="primary-btn" onclick="applySteleScaling()" data-i18n="buttons.apply_scaling">Застосувати масштабування</button>
            </div>
          </div>
          
          <!-- Секція 4: Розміри та центральна деталь (тільки для парних) - під кнопкою -->
          <div class="stele-section conditional" id="stele-options-section" style="display: none;">
            <div class="input-card">
              <!-- Відстань між стелами -->
              <div class="label-with-input">
                <label id="stele-distance-label" for="stele-distance" data-i18n="stele.distance_mm">Відстань між стелами (мм)</label>
                <input type="number" id="stele-distance" value="200" min="0" max="1000" oninput="updateSteleDistance()">
              </div>
              
              <!-- Центральна деталь -->
              <div class="toggle-with-label">
                <span class="toggle-label-text" data-i18n="stele.central_detail">Центральна деталь</span>
                <label class="modern-toggle">
                  <input type="checkbox" id="central-detail" onchange="updateCentralDetail()">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              
              <div class="conditional-content" id="central-detail-dimensions-group" style="display: none;">
                <div class="input-row">
                  <div class="input-wrapper">
                    <label id="central-detail-width-label" for="central-detail-width" data-i18n="labels.central_detail_width_mm">Ширина (мм)</label>
                    <input type="number" id="central-detail-width" value="200" min="50" max="1000" oninput="updateCentralDetailDisplay()">
                  </div>
                  <div class="input-wrapper">
                    <label id="central-detail-depth-label" for="central-detail-depth" data-i18n="labels.central_detail_depth_mm">Товщина (мм)</label>
                    <input type="number" id="central-detail-depth" value="50" min="10" max="200" oninput="updateCentralDetailDisplay()">
                  </div>
                  <div class="input-wrapper">
                    <label id="central-detail-height-label" for="central-detail-height" data-i18n="labels.central_detail_height_mm">Висота (мм)</label>
                    <input type="number" id="central-detail-height" value="1200" min="50" max="2000" oninput="updateCentralDetailDisplay()">
                  </div>
                </div>
                
                <!-- Кнопка оновлення розмірів -->
                <div style="margin-top: 15px; text-align: center;">
                  <button onclick="updateSteleModelWithNewDimensions()" class="btn btn-primary" style="padding: 8px 16px; font-size: 14px;">
                    <span data-i18n="buttons.update_dimensions">Оновити розміри</span>
                  </button>
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

    <!-- Таб "Надгробна частина" -->
    <div class="tab-content" id="gravestone-tab">
      <section class="panel">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.flowerbeds">Квітник</h2>
          <span class="chevron"></span>
          <span id="flowerbeds-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <div class="carousel-container">
            <div class="carousel-viewport" id="flowerbeds-carousel-viewport">
              <div class="carousel-track" id="flowerbeds-carousel-track"></div>
            </div>
          </div>
          <button onclick="addModel('flowerbeds'); advanceToNextPanel(this);" data-i18n="buttons.add_flowerbed">Додати квітник</button>
        </div>
      </section>
      
      <section class="panel collapsed">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.gravestones">Надгробна плита</h2>
          <span class="chevron"></span>
          <span id="gravestones-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <div class="carousel-container">
            <div class="carousel-viewport" id="gravestones-carousel-viewport">
              <div class="carousel-track" id="gravestones-carousel-track"></div>
            </div>
          </div>
          <button onclick="addModel('gravestones'); advanceToNextPanel(this);" data-i18n="buttons.add_gravestone">Додати надгробну плиту</button>
        </div>
      </section>
    </div>

    <!-- Таб "Огорожа" -->
    <div class="tab-content" id="fence-tab">
      <section class="panel">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.fence_corner">Кутова огорожа</h2>
          <span class="chevron"></span>
          <span id="fence-corner-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <div class="input-row">
            <div class="input-wrapper">
              <label id="fence-corner-post-height-label" for="fence-corner-post-height" data-i18n="labels.post_height_mm">Висота стовпа (мм)</label>
              <input type="number" id="fence-corner-post-height" value="250" min="150" max="500" oninput="updateFenceCornerDisplay()">
            </div>
            <div class="input-wrapper">
              <label id="fence-corner-post-size-label" for="fence-corner-post-size" data-i18n="labels.post_size_mm">Розмір стовпа (мм)</label>
              <input type="number" id="fence-corner-post-size" value="150" min="100" max="300" oninput="updateFenceCornerDisplay()">
            </div>
          </div>
          <div class="input-row">
            <div class="input-wrapper">
              <label id="fence-corner-side-height-label" for="fence-corner-side-height" data-i18n="labels.panel_height_mm">Висота панелі (мм)</label>
              <input type="number" id="fence-corner-side-height" value="150" min="100" max="300" oninput="updateFenceCornerDisplay()">
            </div>
            <div class="input-wrapper">
              <label id="fence-corner-side-length-label" for="fence-corner-side-length" data-i18n="labels.panel_length_mm">Довжина панелі (мм)</label>
              <input type="number" id="fence-corner-side-length" value="500" min="200" max="600" oninput="updateFenceCornerDisplay()">
            </div>
            <div class="input-wrapper">
              <label id="fence-corner-side-thickness-label" for="fence-corner-side-thickness" data-i18n="labels.panel_thickness_mm">Товщина панелі (мм)</label>
              <input type="number" id="fence-corner-side-thickness" value="50" min="30" max="150" oninput="updateFenceCornerDisplay()">
            </div>
          </div>
          
          <button onclick="addFenceCorner(); advanceToNextPanel(this);" data-i18n="buttons.create_corner_fence">Створити кутову огорожу</button>
        </div>
      </section>
      
      <section class="panel collapsed">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.fence_perimeter">Периметральна огорожа</h2>
          <span class="chevron"></span>
          <span id="fence-perimeter-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <div class="input-row">
            <div class="input-wrapper">
              <label id="fence-perimeter-post-height-label" for="fence-perimeter-post-height" data-i18n="labels.post_height_mm">Висота стовпа (мм)</label>
              <input type="number" id="fence-perimeter-post-height" value="250" min="150" max="500" oninput="updateFencePerimeterDisplay()">
            </div>
            <div class="input-wrapper">
              <label id="fence-perimeter-post-size-label" for="fence-perimeter-post-size" data-i18n="labels.post_size_mm">Розмір стовпа (мм)</label>
              <input type="number" id="fence-perimeter-post-size" value="150" min="100" max="300" oninput="updateFencePerimeterDisplay()">
            </div>
          </div>
          <div>
            <label class="label-left" data-i18n="labels.intermediate_posts_count">Кількість проміжних стовпів:</label>
            <div class="input-row">
              <div class="input-wrapper">
                <label id="fence-perimeter-north-count-label" for="fence-perimeter-north-count" data-i18n="labels.back_side">Задня сторона</label>
                <input type="number" id="fence-perimeter-north-count" value="1" min="0" max="5" oninput="updateFencePerimeterDisplay()">
              </div>
              <div class="input-wrapper">
                <label id="fence-perimeter-south-count-label" for="fence-perimeter-south-count" data-i18n="labels.entrance">Вхід</label>
                <input type="number" id="fence-perimeter-south-count" value="2" min="0" max="5" oninput="updateFencePerimeterDisplay()">
              </div>
              <div class="input-wrapper">
                <label id="fence-perimeter-east-west-count-label" for="fence-perimeter-east-west-count" data-i18n="labels.side_sides">Бокові сторони</label>
                <input type="number" id="fence-perimeter-east-west-count" value="1" min="0" max="5" oninput="updateFencePerimeterDisplay()">
              </div>
            </div>
          </div>
          <button onclick="addFencePerimeter(); advanceToNextPanel(this);" data-i18n="buttons.create_perimeter_fence">Створити периметральну огорожу</button>
        </div>
      </section>
      
      <section class="panel collapsed">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.fence_decor">Декор огорожі</h2>
          <span class="chevron"></span>
          <span id="fence-decor-dimensions-display" class="header-dimensions"></span>
        </div>
        <div class="panel-content">
          <p class="panel-description">Виберіть декор для стовпчиків огорожі. Декор буде автоматично додано на всі стовпчики існуючої огорожі.</p>
          
          <!-- Карусель декору огорожі -->
          <div class="carousel-container">
            <div class="carousel-viewport" id="fence-decor-carousel-viewport">
              <div class="carousel-track" id="fence-decor-carousel-track"></div>
            </div>
          </div>
          
          <button onclick="addFenceDecor(); advanceToNextPanel(this);" data-i18n="buttons.add_fence_decor">Додати декор на огорожу</button>
        </div>
      </section>
      
    </div>


    <!-- Таб "Вигляд" -->
    <div class="tab-content" id="view-tab">
      <section class="panel">
        <div class="panel-header" onclick="toggleAccordionPanel(this)">
          <h2 class="panel-title" data-i18n="panels.preview">Превью моделі</h2>
          <span class="chevron"></span>
          <span class="header-placeholder"></span>
        </div>
        <div class="panel-content">
          <p class="panel-description">Створіть превью поточної моделі для перегляду та збереження.</p>
          
          <!-- Налаштування превью -->
          <div class="input-row">
            <div class="input-wrapper">
              <label for="preview-size" data-i18n="labels.preview_size">Розмір превью (пікселі)</label>
              <select id="preview-size" onchange="updatePreviewSettings()">
                <option value="256">256x256</option>
                <option value="512" selected>512x512</option>
                <option value="1024">1024x1024</option>
              </select>
            </div>
            <div class="input-wrapper">
              <label for="preview-quality" data-i18n="labels.preview_quality">Якість</label>
              <select id="preview-quality" onchange="updatePreviewSettings()">
                <option value="low" data-i18n="quality.low">Низька</option>
                <option value="medium" selected data-i18n="quality.medium">Середня</option>
                <option value="high" data-i18n="quality.high">Висока</option>
              </select>
            </div>
          </div>
          
          <!-- Кнопка створення превью -->
          <button onclick="generateModelPreview()" id="generate-preview-btn" data-i18n="buttons.generate_preview">
            <span class="button-icon">📷</span>
            Створити превью
          </button>
          
          <!-- Область відображення превью -->
          <div id="preview-container" class="preview-container" style="display: none;">
            <div class="preview-header">
              <h3 data-i18n="preview.title">Превью моделі</h3>
              <div class="preview-actions">
                <button onclick="downloadPreview()" class="action-btn" data-i18n="buttons.download_preview">
                  <span class="button-icon">💾</span>
                  Завантажити
                </button>
                <button onclick="copyPreviewToClipboard()" class="action-btn" data-i18n="buttons.copy_preview">
                  <span class="button-icon">📋</span>
                  Копіювати
                </button>
              </div>
            </div>
            <div class="preview-image-container">
              <img id="preview-image" src="" alt="Превью моделі" class="preview-image">
            </div>
            <div class="preview-info">
              <p id="preview-info-text"></p>
            </div>
          </div>
          
          <!-- Статус генерації -->
          <div id="preview-status" class="preview-status" style="display: none;">
            <div class="status-indicator">
              <div class="spinner"></div>
              <span data-i18n="preview.generating">Генерація превью...</span>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Специфікація (залишається поза табами) -->
    <section class="panel collapsed" id="specification-panel">
      <div class="panel-header" onclick="togglePanel(this)">
        <h2 class="panel-title" data-i18n="summary.title">Специфікація</h2>
        <span class="chevron"></span>
        <span class="header-placeholder"></span>
      </div>
      <div class="panel-content">
        <table class="summary-table">
          <tr> <td data-i18n="summary.foundation">Фундамент:</td> <td id="summary-foundation">--</td> </tr>
          <tr> <td data-i18n="summary.tiling">Плитка (верх):</td> <td id="summary-tiling">--</td> </tr>
          <tr> <td data-i18n="summary.cladding">Облицювання (бік):</td> <td id="summary-cladding">--</td> </tr>
          <tr> <td data-i18n="summary.blind_area">Відмостка:</td> <td id="summary-blind-area">--</td> </tr>
          <tr> <td data-i18n="summary.stand">Підставка:</td> <td id="summary-stand">--</td> </tr>
          <tr> <td data-i18n="summary.flowerbed">Квітник:</td> <td id="summary-flowerbed">--</td> </tr>
          <tr> <td data-i18n="summary.gravestone">Надгробна плита:</td> <td id="summary-gravestone">--</td> </tr>
          <tr> <td data-i18n="summary.stele">Стела:</td> <td id="summary-stele">--</td> </tr>
          <tr> <td data-i18n="summary.fence_corner">Кутова огорожа:</td> <td id="summary-fence-corner">--</td> </tr>
          <tr> <td data-i18n="summary.fence_perimeter">Периметральна огорожа:</td> <td id="summary-fence-perimeter">--</td> </tr>
          <tr> <td data-i18n="summary.fence_decor">Декор огорожі:</td> <td id="summary-fence-decor">--</td> </tr>
        </table>
        <button onclick="refreshSpecification()" class="refresh-button" data-i18n="buttons.refresh">Оновити</button>
      </div>
    </section>

    
  </div>

  <!-- ✅ Підключаємо модулі в правильному порядку (Namespace Pattern) -->
  <!-- 1. Core модулі (залежності) -->
  <script src="modules/core/Config.js"></script>
  <script src="modules/core/Logger.js"></script>
  <script src="modules/core/GlobalState.js"></script>
  <script src="modules/core/I18nManager.js"></script>
  <script src="modules/core/StateManager.js"></script>
  
  <!-- 2. Utils модулі
    -->
  
  <script src="modules/utils/Helpers.js"></script>
  <script src="modules/utils/Validation.js"></script>
  <script src="modules/utils/Units.js"></script>
  
  <!-- 3. Communication модулі -->
  <script src="modules/communication/SketchUpBridge.js"></script>
  
  <!-- 4. UI модулі -->
  <script src="modules/ui/Tabs.js"></script>
  <script src="modules/ui/Panels.js"></script>
  <script src="modules/ui/AccordionManager.js"></script>
  <script src="modules/ui/SummaryTable.js"></script>
  <script src="modules/ui/LanguageSwitcher.js"></script>
  
  <!-- 5. I18n модулі -->
  <script src="i18n/I18nManager.js"></script>
  
  <!-- 6. Builder модулі -->
  <script src="modules/builders/FoundationBuilder.js"></script>
  
  <!-- 7. Головний файл в кінці -->
  <script src="script.js"></script>
  
  <!-- 8. Функції блокування -->
  <script src="blocking-functions.js"></script>
  
  <!-- Debug Log -->
  <div id="debug-log" style="
    position: fixed;
    bottom: 10px;
    right: 10px;
    width: 400px;
    height: 300px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    font-family: monospace;
    font-size: 12px;
    padding: 10px;
    border-radius: 5px;
    overflow-y: auto;
    z-index: 10000;
    display: none;
  "></div>
  
  <!-- Debug Toggle Button -->
  <button id="debug-toggle" onclick="toggleDebugLog()" style="
    position: fixed;
    bottom: 10px;
    right: 420px;
    background: #007bff;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    z-index: 10001;
  ">Debug</button>
  
  <!-- Test Blocking Buttons -->
  <button id="test-block-btn" onclick="testBlockPlugin()" style="
    position: fixed;
    bottom: 80px;
    right: 10px;
    background: #dc3545;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    z-index: 10001;
    font-size: 12px;
    white-space: nowrap;
  ">Тест: Блок</button>
  
  <button id="test-unblock-btn" onclick="testUnblockPlugin()" style="
    position: fixed;
    bottom: 120px;
    right: 10px;
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    z-index: 10001;
    font-size: 12px;
    white-space: nowrap;
  ">Тест: Розблокувати</button>
</body>
</html>