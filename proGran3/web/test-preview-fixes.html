<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGran3 - –¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø—Ä–µ–≤—å—é</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .test-result.pass {
            background-color: #d4edda;
            border-left-color: #28a745;
        }
        .test-result.fail {
            background-color: #f8d7da;
            border-left-color: #dc3545;
        }
        .test-result.info {
            background-color: #d1ecf1;
            border-left-color: #17a2b8;
        }
        .test-result.warning {
            background-color: #fff3cd;
            border-left-color: #ffc107;
        }
        .carousel-item {
            width: 100px;
            height: 100px;
            border: 1px solid #ccc;
            margin: 5px;
            display: inline-block;
            position: relative;
        }
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-size: 10px;
            color: #666;
        }
        .loading-indicator.error {
            color: #dc3545;
        }
        .carousel-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üñºÔ∏è –¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø—Ä–µ–≤—å—é</h1>
        <p>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø—Ä–æ–±–ª–µ–º –∑ base64 –¥–∞–Ω–∏–º–∏ —Ç–∞ pending preview</p>
        
        <div id="test-results"></div>
        
        <h3>–¢–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—É—Å–µ–ª—ñ:</h3>
        <div id="test-carousels">
            <div class="carousel-item" data-filename="test1.skp">
                <div class="loading-indicator">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
            <div class="carousel-item" data-filename="test2.skp">
                <div class="loading-indicator">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
            <div class="carousel-item" data-filename="test3.skp">
                <div class="loading-indicator">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
            </div>
        </div>
        
        <button onclick="runTests()" style="
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        ">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏</button>
    </div>

    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –º–æ–¥—É–ª—ñ -->
    <script src="modules/core/Config.js"></script>
    <script src="modules/core/Logger.js"></script>
    <script src="modules/core/StateManager.js"></script>
    <script src="modules/utils/Helpers.js"></script>
    <script src="modules/utils/Validation.js"></script>
    <script src="modules/utils/Units.js"></script>
    <script src="modules/communication/SketchUpBridge.js"></script>
    <script src="modules/ui/Tabs.js"></script>
    <script src="modules/ui/Panels.js"></script>
    <script src="modules/ui/SummaryTable.js"></script>
    <script src="modules/builders/FoundationBuilder.js"></script>

    <script>
        function addTestResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function runTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '';
            
            addTestResult('üöÄ –ü–æ—á–∞—Ç–æ–∫ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø—Ä–µ–≤—å—é...', 'info');
            
            try {
                // –¢–µ—Å—Ç 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–¥—É–ª—ñ–≤
                if (window.ProGran3 && window.ProGran3.Communication && window.ProGran3.Communication.SketchUpBridge) {
                    addTestResult('‚úÖ SketchUpBridge –º–æ–¥—É–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'pass');
                } else {
                    addTestResult('‚ùå SketchUpBridge –º–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'fail');
                    return;
                }
                
                // –¢–µ—Å—Ç 2: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è addPendingPreview –∑ loadingDiv
                try {
                    const testItem = document.querySelector('.carousel-item[data-filename="test1.skp"]');
                    const testLoadingDiv = testItem.querySelector('.loading-indicator');
                    
                    window.ProGran3.Communication.SketchUpBridge.addPendingPreview(
                        'test/test1.skp', 
                        'test1.skp', 
                        'Test', 
                        testItem, 
                        testLoadingDiv
                    );
                    addTestResult('‚úÖ addPendingPreview –∑ loadingDiv –ø—Ä–∞—Ü—é—î', 'pass');
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ addPendingPreview: ${error.message}`, 'fail');
                }
                
                // –¢–µ—Å—Ç 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è base64 –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
                try {
                    // –¢–µ—Å—Ç –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º base64
                    const validBase64 = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
                    const testItem2 = document.querySelector('.carousel-item[data-filename="test2.skp"]');
                    const testLoadingDiv2 = testItem2.querySelector('.loading-indicator');
                    
                    window.ProGran3.Communication.SketchUpBridge.addPendingPreview(
                        'test/test2.skp', 
                        'test2.skp', 
                        'Test', 
                        testItem2, 
                        testLoadingDiv2
                    );
                    
                    // –°–∏–º—É–ª—é—î–º–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–µ–≤—å—é
                    window.ProGran3.Communication.SketchUpBridge.receiveWebPreview('test/test2.skp', validBase64);
                    addTestResult('‚úÖ –í–∞–ª—ñ–¥–Ω–∏–π base64 –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'pass');
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –æ–±—Ä–æ–±—Ü—ñ –≤–∞–ª—ñ–¥–Ω–æ–≥–æ base64: ${error.message}`, 'fail');
                }
                
                // –¢–µ—Å—Ç 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è base64 –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º
                try {
                    const prefixedBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
                    const testItem3 = document.querySelector('.carousel-item[data-filename="test3.skp"]');
                    const testLoadingDiv3 = testItem3.querySelector('.loading-indicator');
                    
                    window.ProGran3.Communication.SketchUpBridge.addPendingPreview(
                        'test/test3.skp', 
                        'test3.skp', 
                        'Test', 
                        testItem3, 
                        testLoadingDiv3
                    );
                    
                    // –°–∏–º—É–ª—é—î–º–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–µ–≤—å—é –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º
                    window.ProGran3.Communication.SketchUpBridge.receiveWebPreview('test/test3.skp', prefixedBase64);
                    addTestResult('‚úÖ Base64 –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'pass');
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –æ–±—Ä–æ–±—Ü—ñ base64 –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º: ${error.message}`, 'fail');
                }
                
                // –¢–µ—Å—Ç 5: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–µ–≤–∞–ª—ñ–¥–Ω–æ–≥–æ base64
                try {
                    const invalidBase64 = 'invalid-base64-data!!!';
                    const testItem4 = document.createElement('div');
                    testItem4.className = 'carousel-item';
                    testItem4.dataset.filename = 'test4.skp';
                    const testLoadingDiv4 = document.createElement('div');
                    testLoadingDiv4.className = 'loading-indicator';
                    testLoadingDiv4.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
                    testItem4.appendChild(testLoadingDiv4);
                    document.getElementById('test-carousels').appendChild(testItem4);
                    
                    window.ProGran3.Communication.SketchUpBridge.addPendingPreview(
                        'test/test4.skp', 
                        'test4.skp', 
                        'Test', 
                        testItem4, 
                        testLoadingDiv4
                    );
                    
                    // –°–∏–º—É–ª—é—î–º–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–µ–≤–∞–ª—ñ–¥–Ω–æ–≥–æ –ø—Ä–µ–≤—å—é
                    window.ProGran3.Communication.SketchUpBridge.receiveWebPreview('test/test4.skp', invalidBase64);
                    addTestResult('‚úÖ –ù–µ–≤–∞–ª—ñ–¥–Ω–∏–π base64 –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'pass');
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –æ–±—Ä–æ–±—Ü—ñ –Ω–µ–≤–∞–ª—ñ–¥–Ω–æ–≥–æ base64: ${error.message}`, 'fail');
                }
                
                // –¢–µ—Å—Ç 6: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è handlePreviewError
                try {
                    const testItem5 = document.createElement('div');
                    testItem5.className = 'carousel-item';
                    testItem5.dataset.filename = 'test5.skp';
                    const testLoadingDiv5 = document.createElement('div');
                    testLoadingDiv5.className = 'loading-indicator';
                    testLoadingDiv5.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
                    testItem5.appendChild(testLoadingDiv5);
                    document.getElementById('test-carousels').appendChild(testItem5);
                    
                    window.ProGran3.Communication.SketchUpBridge.addPendingPreview(
                        'test/test5.skp', 
                        'test5.skp', 
                        'Test', 
                        testItem5, 
                        testLoadingDiv5
                    );
                    
                    // –°–∏–º—É–ª—é—î–º–æ –ø–æ–º–∏–ª–∫—É
                    window.ProGran3.Communication.SketchUpBridge.handlePreviewError('test/test5.skp', 'Test error message');
                    addTestResult('‚úÖ handlePreviewError –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'pass');
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ handlePreviewError: ${error.message}`, 'fail');
                }
                
                // –¢–µ—Å—Ç 7: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è pending
                try {
                    const pendingCount = Object.keys(window.ProGran3.Communication.SketchUpBridge.getConnectionStatus().pendingPreviews || {}).length;
                    if (pendingCount === 0) {
                        addTestResult('‚úÖ Pending –¥–∞–Ω—ñ –æ—á–∏—â–∞—é—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'pass');
                    } else {
                        addTestResult(`‚ö†Ô∏è –ó–∞–ª–∏—à–∏–ª–æ—Å—å ${pendingCount} pending –∑–∞–ø–∏—Å—ñ–≤`, 'warning');
                    }
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ pending: ${error.message}`, 'fail');
                }
                
                addTestResult('üèÅ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø—Ä–µ–≤—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', 'info');
                addTestResult('‚úÖ –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –ø—Ä–µ–≤—å—é –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ!', 'pass');
                
            } catch (error) {
                addTestResult(`‚ùå –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –≤ —Ç–µ—Å—Ç—ñ: ${error.message}`, 'fail');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
