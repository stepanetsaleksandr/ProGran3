<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Debug I18n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .debug-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .debug-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .debug-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    .debug-button:hover {
      background: #0056b3;
    }
    .debug-result {
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 3px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .warning { background: #fff3cd; color: #856404; }
    .info { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <div class="debug-container">
    <h1>üîç Debug I18n System</h1>
    
    <div class="debug-section">
      <h2>1. –¢–µ—Å—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤</h2>
      <button class="debug-button" onclick="testFileLoading()">–¢–µ—Å—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤</button>
      <div id="file-loading-result" class="debug-result">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
    </div>
    
    <div class="debug-section">
      <h2>2. –¢–µ—Å—Ç I18nManager</h2>
      <button class="debug-button" onclick="testI18nManager()">–¢–µ—Å—Ç I18nManager</button>
      <div id="i18n-manager-result" class="debug-result">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
    </div>
    
    <div class="debug-section">
      <h2>3. –¢–µ—Å—Ç –∑–º—ñ–Ω–∏ –º–æ–≤–∏</h2>
      <button class="debug-button" onclick="testLanguageChange('uk')">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
      <button class="debug-button" onclick="testLanguageChange('pl')">üáµüá± Polski</button>
      <button class="debug-button" onclick="testLanguageChange('en')">üá¨üáß English</button>
      <div id="language-change-result" class="debug-result">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
    </div>
    
    <div class="debug-section">
      <h2>4. –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤</h2>
      <button class="debug-button" onclick="testTranslations()">–¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤</button>
      <div id="translations-result" class="debug-result">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...</div>
    </div>
    
    <div class="debug-section">
      <h2>5. –õ–æ–≥–∏</h2>
      <div id="debug-logs" class="debug-result" style="height: 200px; overflow-y: auto;">
        üîç –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–≤...
      </div>
    </div>
  </div>

  <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –º–æ–¥—É–ª—ñ -->
  <script src="modules/core/Logger.js"></script>
  <script src="modules/ui/LanguageSwitcher.js"></script>
  <script src="i18n/I18nManager.js"></script>
  
  <script>
    // –õ–æ–≥–≥–µ—Ä –¥–ª—è debug
    function logDebug(message, type = 'info') {
      const logs = document.getElementById('debug-logs');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = type;
      logEntry.textContent = `[${timestamp}] ${message}`;
      logs.appendChild(logEntry);
      logs.scrollTop = logs.scrollHeight;
    }
    
    // –¢–µ—Å—Ç –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
    async function testFileLoading() {
      const result = document.getElementById('file-loading-result');
      result.textContent = '–¢–µ—Å—Ç—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤...';
      result.className = 'debug-result info';
      
      const languages = ['uk', 'pl', 'en'];
      let results = [];
      
      for (const lang of languages) {
        try {
          const response = await fetch(`i18n/locales/${lang}.json`);
          if (response.ok) {
            const data = await response.json();
            results.push(`‚úÖ ${lang}.json: OK (${Object.keys(data).length} –∫–∞—Ç–µ–≥–æ—Ä—ñ–π)`);
            logDebug(`‚úÖ ${lang}.json –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ`, 'success');
          } else {
            results.push(`‚ùå ${lang}.json: HTTP ${response.status}`);
            logDebug(`‚ùå ${lang}.json: HTTP ${response.status}`, 'error');
          }
        } catch (error) {
          results.push(`‚ùå ${lang}.json: ${error.message}`);
          logDebug(`‚ùå ${lang}.json: ${error.message}`, 'error');
        }
      }
      
      result.textContent = results.join('\n');
      result.className = 'debug-result ' + (results.some(r => r.includes('‚ùå')) ? 'error' : 'success');
    }
    
    // –¢–µ—Å—Ç I18nManager
    async function testI18nManager() {
      const result = document.getElementById('i18n-manager-result');
      result.textContent = '–¢–µ—Å—Ç—É—î–º–æ I18nManager...';
      result.className = 'debug-result info';
      
      try {
        if (window.ProGran3 && window.ProGran3.I18n && window.ProGran3.I18n.Manager) {
          const manager = window.ProGran3.I18n.Manager;
          
          // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ
          await manager.init();
          
          const info = [
            `‚úÖ I18nManager –¥–æ—Å—Ç—É–ø–Ω–∏–π`,
            `üìç –ü–æ—Ç–æ—á–Ω–∞ –º–æ–≤–∞: ${manager.getCurrentLanguage()}`,
            `üåç –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –º–æ–≤–∏: ${manager.getSupportedLanguages().map(l => l.code).join(', ')}`,
            `üìö –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –ø–µ—Ä–µ–∫–ª–∞–¥–∏: ${Object.keys(manager.translations).length} –∫–∞—Ç–µ–≥–æ—Ä—ñ–π`,
            `üîß localStorage: ${localStorage.getItem('progran3_language') || '–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'}`
          ];
          
          result.textContent = info.join('\n');
          result.className = 'debug-result success';
          logDebug('I18nManager —Ç–µ—Å—Ç –ø—Ä–æ–π—à–æ–≤ —É—Å–ø—ñ—à–Ω–æ', 'success');
        } else {
          result.textContent = '‚ùå I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
          result.className = 'debug-result error';
          logDebug('I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π', 'error');
        }
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'debug-result error';
        logDebug(`–ü–æ–º–∏–ª–∫–∞ I18nManager: ${error.message}`, 'error');
      }
    }
    
    // –¢–µ—Å—Ç –∑–º—ñ–Ω–∏ –º–æ–≤–∏
    async function testLanguageChange(lang) {
      const result = document.getElementById('language-change-result');
      result.textContent = `–¢–µ—Å—Ç—É—î–º–æ –∑–º—ñ–Ω—É –º–æ–≤–∏ –Ω–∞: ${lang}...`;
      result.className = 'debug-result info';
      
      try {
        if (window.ProGran3 && window.ProGran3.I18n && window.ProGran3.I18n.Manager) {
          const manager = window.ProGran3.I18n.Manager;
          const success = await manager.changeLanguage(lang);
          
          if (success) {
            const info = [
              `‚úÖ –ú–æ–≤—É –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${lang}`,
              `üìç –ü–æ—Ç–æ—á–Ω–∞ –º–æ–≤–∞: ${manager.getCurrentLanguage()}`,
              `üîß localStorage: ${localStorage.getItem('progran3_language')}`,
              `üìö –ü–µ—Ä–µ–∫–ª–∞–¥–∏: ${Object.keys(manager.translations).length} –∫–∞—Ç–µ–≥–æ—Ä—ñ–π`,
              `üß™ –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—É: ${manager.t('ui.foundation')}`
            ];
            
            result.textContent = info.join('\n');
            result.className = 'debug-result success';
            logDebug(`–ú–æ–≤—É —É—Å–ø—ñ—à–Ω–æ –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${lang}`, 'success');
          } else {
            result.textContent = `‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É –Ω–∞: ${lang}`;
            result.className = 'debug-result error';
            logDebug(`–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É –Ω–∞: ${lang}`, 'error');
          }
        } else {
          result.textContent = '‚ùå I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
          result.className = 'debug-result error';
          logDebug('I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π', 'error');
        }
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'debug-result error';
        logDebug(`–ü–æ–º–∏–ª–∫–∞ –∑–º—ñ–Ω–∏ –º–æ–≤–∏: ${error.message}`, 'error');
      }
    }
    
    // –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤
    function testTranslations() {
      const result = document.getElementById('translations-result');
      result.textContent = '–¢–µ—Å—Ç—É—î–º–æ –ø–µ—Ä–µ–∫–ª–∞–¥–∏...';
      result.className = 'debug-result info';
      
      try {
        if (window.ProGran3 && window.ProGran3.I18n && window.ProGran3.I18n.Manager) {
          const manager = window.ProGran3.I18n.Manager;
          const currentLang = manager.getCurrentLanguage();
          
          const testKeys = [
            'ui.foundation',
            'ui.stele',
            'buttons.create',
            'buttons.add',
            'tabs.base',
            'panels.foundation'
          ];
          
          const results = testKeys.map(key => {
            const translation = manager.t(key);
            const status = translation !== key ? '‚úÖ' : '‚ùå';
            return `${status} ${key}: ${translation}`;
          });
          
          result.textContent = [
            `üåç –ü–æ—Ç–æ—á–Ω–∞ –º–æ–≤–∞: ${currentLang}`,
            '',
            ...results
          ].join('\n');
          
          result.className = 'debug-result ' + (results.some(r => r.includes('‚ùå')) ? 'warning' : 'success');
          logDebug('–¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
        } else {
          result.textContent = '‚ùå I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
          result.className = 'debug-result error';
          logDebug('I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π', 'error');
        }
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'debug-result error';
        logDebug(`–ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤: ${error.message}`, 'error');
      }
    }
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    window.onload = async function() {
      logDebug('üöÄ –ó–∞–ø—É—Å–∫ debug I18n —Å–∏—Å—Ç–µ–º–∏...', 'info');
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç–∏
      setTimeout(testFileLoading, 500);
      setTimeout(testI18nManager, 1000);
    };
  </script>
</body>
</html>
