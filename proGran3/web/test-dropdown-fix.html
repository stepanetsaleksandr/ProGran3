<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Test Dropdown Fix</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #0056b3;
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 3px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .warning { background: #fff3cd; color: #856404; }
    .info { background: #d1ecf1; color: #0c5460; }
    
    /* –°—Ç–∏–ª—ñ –¥–ª—è header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
    }
    .header-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      position: relative;
    }
    .unit-switcher {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      padding: 8px 12px;
      border-radius: 6px;
    }
    .unit-switcher input[type="radio"] {
      display: none;
    }
    .unit-switcher label {
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.3s;
    }
    .unit-switcher label:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .unit-switcher input[type="radio"]:checked + label {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è */
    .debug-info {
      background: #e9ecef;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üîß Test Dropdown Fix</h1>
    
    <!-- –Ü–º—ñ—Ç–∞—Ü—ñ—è header –∑ –ø–µ—Ä–µ–º–∏–∫–∞—á–µ–º –º–æ–≤ -->
    <div class="header">
      <h1>ProGran</h1>
      <div class="header-controls">
        <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –±—É–¥–µ –¥–æ–¥–∞–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
        <div class="unit-switcher">
          <input type="radio" id="unit-mm" name="unit" value="mm" checked>
          <label for="unit-mm">–º–º</label>
          <input type="radio" id="unit-cm" name="unit" value="cm">
          <label for="unit-cm">—Å–º</label>
        </div>
      </div>
    </div>
    
    <div class="test-section">
      <h2>1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ç–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è</h2>
      <div id="auto-test-result" class="test-result info">
        –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Ç–µ—Å—Ç—É...
      </div>
    </div>
    
    <div class="test-section">
      <h2>2. –¢–µ—Å—Ç CSS —Å—Ç–∏–ª—ñ–≤</h2>
      <button class="test-button" onclick="testCSSStyles()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ CSS —Å—Ç–∏–ª—ñ</button>
      <div id="css-test-result" class="test-result info">
        –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ CSS...
      </div>
    </div>
    
    <div class="test-section">
      <h2>3. –¢–µ—Å—Ç DOM —Å—Ç—Ä—É–∫—Ç—É—Ä–∏</h2>
      <button class="test-button" onclick="testDOMStructure()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ DOM</button>
      <div id="dom-test-result" class="test-result info">
        –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ DOM...
      </div>
    </div>
    
    <div class="test-section">
      <h2>4. –¢–µ—Å—Ç –∫–ª—ñ–∫—ñ–≤</h2>
      <p><strong>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</strong> –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –ø–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –≤–∏—â–µ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è dropdown –∑ 3 –º–æ–≤–∞–º–∏.</p>
      <div id="click-test-result" class="test-result info">
        –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –ø–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...
      </div>
    </div>
    
    <div class="test-section">
      <h2>5. –ö–æ–Ω—Å–æ–ª—å–Ω—ñ –ª–æ–≥–∏</h2>
      <div id="console-logs" class="test-result" style="height: 200px; overflow-y: auto;">
        üîç –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–≤ –∑ –∫–æ–Ω—Å–æ–ª—ñ...
      </div>
    </div>
  </div>

  <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –º–æ–¥—É–ª—ñ -->
  <script src="modules/core/Logger.js"></script>
  <script src="modules/ui/LanguageSwitcher.js"></script>
  <script src="i18n/I18nManager.js"></script>
  
  <script>
    // –ü–µ—Ä–µ—Ö–æ–ø–ª—é—î–º–æ console.log –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      
      const logs = document.getElementById('console-logs');
      if (logs) {
        const timestamp = new Date().toLocaleTimeString();
        const message = args.map(arg => 
          typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
        ).join(' ');
        
        const logEntry = document.createElement('div');
        logEntry.textContent = `[${timestamp}] ${message}`;
        logEntry.style.marginBottom = '5px';
        logEntry.style.fontSize = '12px';
        logs.appendChild(logEntry);
        logs.scrollTop = logs.scrollHeight;
      }
    };
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ç–µ—Å—Ç
    async function runAutoTest() {
      const result = document.getElementById('auto-test-result');
      
      try {
        // –û—á–∏—â—É—î–º–æ localStorage
        localStorage.removeItem('progran3_language');
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ I18nManager
        if (window.ProGran3 && window.ProGran3.I18n && window.ProGran3.I18n.Manager) {
          await window.ProGran3.I18n.Manager.init();
          
          // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ LanguageSwitcher
          if (window.ProGran3.UI && window.ProGran3.UI.LanguageSwitcher) {
            window.ProGran3.UI.LanguageSwitcher.init();
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const switcher = document.getElementById('language-switcher');
            const dropdown = switcher ? switcher.querySelector('.language-dropdown') : null;
            const options = dropdown ? dropdown.querySelectorAll('.language-option') : [];
            const currentLang = window.ProGran3.I18n.Manager.getCurrentLanguage();
            
            const info = [
              `‚úÖ I18nManager —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ`,
              `‚úÖ LanguageSwitcher —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ`,
              `üìç –ü–æ—Ç–æ—á–Ω–∞ –º–æ–≤–∞: ${currentLang}`,
              `üìç –ü–µ—Ä–µ–º–∏–∫–∞—á –∑–Ω–∞–π–¥–µ–Ω–æ: ${!!switcher}`,
              `üìç Dropdown –∑–Ω–∞–π–¥–µ–Ω–æ: ${!!dropdown}`,
              `üìç –û–ø—Ü—ñ–π –º–æ–≤: ${options.length}`,
              `üìç –û—á—ñ–∫—É–≤–∞–Ω–æ: 3 –æ–ø—Ü—ñ—ó (uk, pl, en)`,
              `üìç –°—Ç–∞—Ä—Ç–æ–≤–∞ –º–æ–≤–∞: ${currentLang === 'uk' ? '–ø—Ä–∞–≤–∏–ª—å–Ω–æ (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞)' : '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'}`,
              `üìç –°–ø–∏—Å–æ–∫ –º–æ–≤: ${options.length === 3 ? '–ø—Ä–∞–≤–∏–ª—å–Ω–æ' : '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'}`,
              ``,
              `üîß CSS –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:`,
              `  - position: ${dropdown ? getComputedStyle(dropdown).position : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`,
              `  - top: ${dropdown ? getComputedStyle(dropdown).top : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`,
              `  - left: ${dropdown ? getComputedStyle(dropdown).left : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`
            ];
            
            const isSuccess = currentLang === 'uk' && options.length === 3;
            result.textContent = info.join('\n');
            result.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            
          } else {
            result.textContent = '‚ùå LanguageSwitcher –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
            result.className = 'test-result error';
          }
        } else {
          result.textContent = '‚ùå I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
          result.className = 'test-result error';
        }
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'test-result error';
      }
    }
    
    // –¢–µ—Å—Ç CSS —Å—Ç–∏–ª—ñ–≤
    function testCSSStyles() {
      const result = document.getElementById('css-test-result');
      
      try {
        const switcher = document.getElementById('language-switcher');
        if (!switcher) {
          result.textContent = '‚ùå –ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
          result.className = 'test-result error';
          return;
        }
        
        const dropdown = switcher.querySelector('.language-dropdown');
        if (!dropdown) {
          result.textContent = '‚ùå Dropdown –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
          result.className = 'test-result error';
          return;
        }
        
        const styles = getComputedStyle(dropdown);
        const info = [
          `‚úÖ Dropdown –∑–Ω–∞–π–¥–µ–Ω–æ`,
          ``,
          `üìã CSS —Å—Ç–∏–ª—ñ:`,
          `  position: ${styles.position}`,
          `  top: ${styles.top}`,
          `  left: ${styles.left}`,
          `  right: ${styles.right}`,
          `  opacity: ${styles.opacity}`,
          `  visibility: ${styles.visibility}`,
          `  transform: ${styles.transform}`,
          `  z-index: ${styles.zIndex}`,
          `  min-width: ${styles.minWidth}`,
          ``,
          `üîß –û—á—ñ–∫—É–≤–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è:`,
          `  position: absolute`,
          `  top: 100%`,
          `  left: 0`,
          `  opacity: 0 (–∫–æ–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∏–π)`,
          `  visibility: hidden (–∫–æ–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∏–π)`
        ];
        
        const isCorrect = styles.position === 'absolute' && styles.top === '100%' && styles.left === '0px';
        result.textContent = info.join('\n');
        result.className = `test-result ${isCorrect ? 'success' : 'warning'}`;
        
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'test-result error';
      }
    }
    
    // –¢–µ—Å—Ç DOM —Å—Ç—Ä—É–∫—Ç—É—Ä–∏
    function testDOMStructure() {
      const result = document.getElementById('dom-test-result');
      
      try {
        const switcher = document.getElementById('language-switcher');
        if (!switcher) {
          result.textContent = '‚ùå –ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
          result.className = 'test-result error';
          return;
        }
        
        const toggle = switcher.querySelector('.language-toggle');
        const dropdown = switcher.querySelector('.language-dropdown');
        const options = dropdown ? dropdown.querySelectorAll('.language-option') : [];
        
        const info = [
          `‚úÖ –ü–µ—Ä–µ–º–∏–∫–∞—á –∑–Ω–∞–π–¥–µ–Ω–æ`,
          `üìç Toggle: ${toggle ? '–∑–Ω–∞–π–¥–µ–Ω–æ' : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`,
          `üìç Dropdown: ${dropdown ? '–∑–Ω–∞–π–¥–µ–Ω–æ' : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`,
          `üìç –û–ø—Ü—ñ–π –º–æ–≤: ${options.length}`,
          ``,
          `üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ toggle:`,
          `  - Flag: ${toggle ? toggle.querySelector('.language-flag')?.textContent : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`,
          `  - Name: ${toggle ? toggle.querySelector('.language-name')?.textContent : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`,
          `  - Arrow: ${toggle ? toggle.querySelector('.language-arrow')?.textContent : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'}`,
          ``,
          `üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ dropdown:`,
          ...Array.from(options).map((opt, index) => {
            const lang = opt.dataset.lang;
            const flag = opt.querySelector('.option-flag')?.textContent;
            const name = opt.querySelector('.option-name')?.textContent;
            return `  ${index + 1}. ${lang}: ${flag} ${name}`;
          }),
          ``,
          `üîß HTML dropdown (–ø–µ—Ä—à—ñ 300 —Å–∏–º–≤–æ–ª—ñ–≤):`,
          dropdown ? dropdown.innerHTML.substring(0, 300) + '...' : '–Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'
        ];
        
        const isSuccess = toggle && dropdown && options.length === 3;
        result.textContent = info.join('\n');
        result.className = `test-result ${isSuccess ? 'success' : 'error'}`;
        
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'test-result error';
      }
    }
    
    // –¢–µ—Å—Ç –∫–ª—ñ–∫—ñ–≤
    function testClicks() {
      const result = document.getElementById('click-test-result');
      
      try {
        const switcher = document.getElementById('language-switcher');
        if (!switcher) {
          result.textContent = '‚ùå –ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
          result.className = 'test-result error';
          return;
        }
        
        const toggle = switcher.querySelector('.language-toggle');
        const dropdown = switcher.querySelector('.language-dropdown');
        
        if (!toggle || !dropdown) {
          result.textContent = '‚ùå Toggle –∞–±–æ dropdown –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
          result.className = 'test-result error';
          return;
        }
        
        // –°–∏–º—É–ª—é—î–º–æ –∫–ª—ñ–∫
        const clickEvent = new MouseEvent('click', {
          bubbles: true,
          cancelable: true
        });
        
        toggle.dispatchEvent(clickEvent);
        
        const isActive = dropdown.classList.contains('active');
        const styles = getComputedStyle(dropdown);
        
        const info = [
          `‚úÖ Toggle —Ç–∞ dropdown –∑–Ω–∞–π–¥–µ–Ω–æ`,
          `üìç –°–∏–º—É–ª—å–æ–≤–∞–Ω–æ –∫–ª—ñ–∫`,
          `üìç Dropdown –∞–∫—Ç–∏–≤–Ω–∏–π: ${isActive ? '—Ç–∞–∫' : '–Ω—ñ'}`,
          `üìç –°—Ç–∏–ª—ñ –ø—ñ—Å–ª—è –∫–ª—ñ–∫—É:`,
          `  opacity: ${styles.opacity}`,
          `  visibility: ${styles.visibility}`,
          `  transform: ${styles.transform}`,
          ``,
          `üí° –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –ø–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –≤–∏—â–µ —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ dropdown –≤—Ä—É—á–Ω—É`
        ];
        
        result.textContent = info.join('\n');
        result.className = `test-result ${isActive ? 'success' : 'warning'}`;
        
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'test-result error';
      }
    }
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    window.onload = async function() {
      console.log('üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—É –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è dropdown...');
      
      // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ç–µ—Å—Ç
      await runAutoTest();
      
      // –ó–∞–ø—É—Å–∫–∞—î–º–æ —ñ–Ω—à—ñ —Ç–µ—Å—Ç–∏
      setTimeout(testCSSStyles, 1000);
      setTimeout(testDOMStructure, 1500);
      setTimeout(testClicks, 2000);
      
      console.log('‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
    };
  </script>
</body>
</html>
