<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Test Language Switcher Fix</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    .test-button:hover {
      background: #0056b3;
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 3px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .warning { background: #fff3cd; color: #856404; }
    .info { background: #d1ecf1; color: #0c5460; }
    
    /* –°—Ç–∏–ª—ñ –¥–ª—è header (—ñ–º—ñ—Ç–∞—Ü—ñ—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É) */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
    }
    .header-controls {
      display: flex;
      align-items: center;
      gap: 16px;
      position: relative;
    }
    .unit-switcher {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      padding: 8px 12px;
      border-radius: 6px;
    }
    .unit-switcher input[type="radio"] {
      display: none;
    }
    .unit-switcher label {
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.3s;
    }
    .unit-switcher label:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    .unit-switcher input[type="radio"]:checked + label {
      background: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üîß Test Language Switcher Fix</h1>
    
    <!-- –Ü–º—ñ—Ç–∞—Ü—ñ—è header –∑ –ø–µ—Ä–µ–º–∏–∫–∞—á–µ–º –º–æ–≤ -->
    <div class="header">
      <h1>ProGran</h1>
      <div class="header-controls">
        <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –±—É–¥–µ –¥–æ–¥–∞–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
        <div class="unit-switcher">
          <input type="radio" id="unit-mm" name="unit" value="mm" checked>
          <label for="unit-mm">–º–º</label>
          <input type="radio" id="unit-cm" name="unit" value="cm">
          <label for="unit-cm">—Å–º</label>
        </div>
      </div>
    </div>
    
    <div class="test-section">
      <h2>1. –¢–µ—Å—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ—ó –º–æ–≤–∏</h2>
      <button class="test-button" onclick="testStartupLanguage()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ä—Ç–æ–≤—É –º–æ–≤—É</button>
      <div id="startup-result" class="test-result info">
        –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...
      </div>
    </div>
    
    <div class="test-section">
      <h2>2. –¢–µ—Å—Ç —Å–ø–∏—Å–∫—É –º–æ–≤ —É –ø–µ—Ä–µ–º–∏–∫–∞—á—ñ</h2>
      <button class="test-button" onclick="testLanguageList()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –º–æ–≤</button>
      <div id="list-result" class="test-result info">
        –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...
      </div>
    </div>
    
    <div class="test-section">
      <h2>3. –¢–µ—Å—Ç –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º–æ–≤</h2>
      <button class="test-button" onclick="testLanguageSwitch('uk')">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
      <button class="test-button" onclick="testLanguageSwitch('pl')">üáµüá± Polski</button>
      <button class="test-button" onclick="testLanguageSwitch('en')">üá¨üáß English</button>
      <div id="switch-result" class="test-result info">
        –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è...
      </div>
    </div>
    
    <div class="test-section">
      <h2>4. –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—ñ–≤</h2>
      <div id="translation-test" class="test-result">
        <p data-i18n="ui.foundation">–§—É–Ω–¥–∞–º–µ–Ω—Ç</p>
        <p data-i18n="ui.stele">–°—Ç–µ–ª–∞</p>
        <p data-i18n="buttons.create">–°—Ç–≤–æ—Ä–∏—Ç–∏</p>
        <p data-i18n="tabs.base">–ë–∞–∑–∞</p>
        <p data-i18n="panels.foundation">–§—É–Ω–¥–∞–º–µ–Ω—Ç</p>
      </div>
    </div>
    
    <div class="test-section">
      <h2>5. –õ–æ–≥–∏</h2>
      <div id="test-logs" class="test-result" style="height: 200px; overflow-y: auto;">
        üîç –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ª–æ–≥—ñ–≤...
      </div>
    </div>
  </div>

  <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –º–æ–¥—É–ª—ñ -->
  <script src="modules/core/Logger.js"></script>
  <script src="modules/ui/LanguageSwitcher.js"></script>
  <script src="i18n/I18nManager.js"></script>
  
  <script>
    // –õ–æ–≥–≥–µ—Ä –¥–ª—è —Ç–µ—Å—Ç—ñ–≤
    function logTest(message, type = 'info') {
      const logs = document.getElementById('test-logs');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = type;
      logEntry.textContent = `[${timestamp}] ${message}`;
      logs.appendChild(logEntry);
      logs.scrollTop = logs.scrollHeight;
    }
    
    // –¢–µ—Å—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ—ó –º–æ–≤–∏
    function testStartupLanguage() {
      const result = document.getElementById('startup-result');
      
      try {
        if (window.ProGran3 && window.ProGran3.I18n && window.ProGran3.I18n.Manager) {
          const manager = window.ProGran3.I18n.Manager;
          const currentLang = manager.getCurrentLanguage();
          const savedLang = localStorage.getItem('progran3_language');
          const browserLang = navigator.language.split('-')[0];
          
          const info = [
            `üìç –ü–æ—Ç–æ—á–Ω–∞ –º–æ–≤–∞: ${currentLang}`,
            `üíæ –ó–±–µ—Ä–µ–∂–µ–Ω–∞ –º–æ–≤–∞: ${savedLang || '–Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'}`,
            `üåç –ú–æ–≤–∞ –±—Ä–∞—É–∑–µ—Ä–∞: ${browserLang}`,
            `‚úÖ –û—á—ñ–∫—É–≤–∞–Ω–∞ –º–æ–≤–∞: uk (—É–∫—Ä–∞—ó–Ω—Å—å–∫–∞)`,
            `üß™ –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—É: ${manager.t('ui.foundation')}`
          ];
          
          const isCorrect = currentLang === 'uk';
          result.textContent = info.join('\n');
          result.className = `test-result ${isCorrect ? 'success' : 'error'}`;
          
          logTest(`–°—Ç–∞—Ä—Ç–æ–≤–∞ –º–æ–≤–∞: ${currentLang} (${isCorrect ? '–ø—Ä–∞–≤–∏–ª—å–Ω–æ' : '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'})`, isCorrect ? 'success' : 'error');
        } else {
          result.textContent = '‚ùå I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
          result.className = 'test-result error';
          logTest('I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π', 'error');
        }
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'test-result error';
        logTest(`–ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É —Å—Ç–∞—Ä—Ç–æ–≤–æ—ó –º–æ–≤–∏: ${error.message}`, 'error');
      }
    }
    
    // –¢–µ—Å—Ç —Å–ø–∏—Å–∫—É –º–æ–≤
    function testLanguageList() {
      const result = document.getElementById('list-result');
      
      try {
        const switcher = document.getElementById('language-switcher');
        if (switcher) {
          const options = switcher.querySelectorAll('.language-option');
          const optionTexts = Array.from(options).map(opt => {
            const flag = opt.querySelector('.option-flag').textContent;
            const name = opt.querySelector('.option-name').textContent;
            const lang = opt.dataset.lang;
            return `${flag} ${name} (${lang})`;
          });
          
          const info = [
            `üìã –ó–Ω–∞–π–¥–µ–Ω–æ –æ–ø—Ü—ñ–π –º–æ–≤: ${options.length}`,
            `üìù –°–ø–∏—Å–æ–∫ –º–æ–≤:`,
            ...optionTexts.map(text => `  ‚Ä¢ ${text}`),
            `‚úÖ –û—á—ñ–∫—É–≤–∞–Ω–æ: 3 –º–æ–≤–∏ (uk, pl, en)`
          ];
          
          const isCorrect = options.length === 3;
          result.textContent = info.join('\n');
          result.className = `test-result ${isCorrect ? 'success' : 'error'}`;
          
          logTest(`–°–ø–∏—Å–æ–∫ –º–æ–≤: ${options.length} –æ–ø—Ü—ñ–π (${isCorrect ? '–ø—Ä–∞–≤–∏–ª—å–Ω–æ' : '–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'})`, isCorrect ? 'success' : 'error');
        } else {
          result.textContent = '‚ùå –ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
          result.className = 'test-result error';
          logTest('–ü–µ—Ä–µ–º–∏–∫–∞—á –º–æ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ', 'error');
        }
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'test-result error';
        logTest(`–ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É —Å–ø–∏—Å–∫—É –º–æ–≤: ${error.message}`, 'error');
      }
    }
    
    // –¢–µ—Å—Ç –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º–æ–≤
    async function testLanguageSwitch(lang) {
      const result = document.getElementById('switch-result');
      result.textContent = `–¢–µ—Å—Ç—É—î–º–æ –∑–º—ñ–Ω—É –º–æ–≤–∏ –Ω–∞: ${lang}...`;
      result.className = 'test-result info';
      
      try {
        if (window.ProGran3 && window.ProGran3.I18n && window.ProGran3.I18n.Manager) {
          const manager = window.ProGran3.I18n.Manager;
          const success = await manager.changeLanguage(lang);
          
          if (success) {
            const currentLang = manager.getCurrentLanguage();
            const info = [
              `‚úÖ –ú–æ–≤—É –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${lang}`,
              `üìç –ü–æ—Ç–æ—á–Ω–∞ –º–æ–≤–∞: ${currentLang}`,
              `üß™ –¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª–∞–¥—É: ${manager.t('ui.foundation')}`,
              `üß™ –¢–µ—Å—Ç –∫–Ω–æ–ø–∫–∏: ${manager.t('buttons.create')}`,
              `üß™ –¢–µ—Å—Ç —Ç–∞–±—É: ${manager.t('tabs.base')}`
            ];
            
            result.textContent = info.join('\n');
            result.className = 'test-result success';
            logTest(`–ú–æ–≤—É —É—Å–ø—ñ—à–Ω–æ –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${lang}`, 'success');
          } else {
            result.textContent = `‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É –Ω–∞: ${lang}`;
            result.className = 'test-result error';
            logTest(`–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É –Ω–∞: ${lang}`, 'error');
          }
        } else {
          result.textContent = '‚ùå I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
          result.className = 'test-result error';
          logTest('I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π', 'error');
        }
      } catch (error) {
        result.textContent = `‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`;
        result.className = 'test-result error';
        logTest(`–ü–æ–º–∏–ª–∫–∞ –∑–º—ñ–Ω–∏ –º–æ–≤–∏: ${error.message}`, 'error');
      }
    }
    
    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
    window.onload = async function() {
      logTest('üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—É –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–º–∏–∫–∞—á–∞ –º–æ–≤...', 'info');
      
      try {
        // –û—á–∏—â—É—î–º–æ localStorage –¥–ª—è —Ç–µ—Å—Ç—É
        localStorage.removeItem('progran3_language');
        logTest('üßπ –û—á–∏—â–µ–Ω–æ localStorage –¥–ª—è —Ç–µ—Å—Ç—É', 'info');
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ I18nManager
        if (window.ProGran3 && window.ProGran3.I18n && window.ProGran3.I18n.Manager) {
          await window.ProGran3.I18n.Manager.init();
          logTest('‚úÖ I18nManager —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ', 'success');
          
          // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ LanguageSwitcher
          if (window.ProGran3.UI && window.ProGran3.UI.LanguageSwitcher) {
            window.ProGran3.UI.LanguageSwitcher.init();
            logTest('‚úÖ LanguageSwitcher —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ', 'success');
          }
          
          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç–∏
          setTimeout(testStartupLanguage, 500);
          setTimeout(testLanguageList, 1000);
        } else {
          logTest('‚ùå I18nManager –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π', 'error');
        }
      } catch (error) {
        logTest(`‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ${error.message}`, 'error');
      }
    };
  </script>
</body>
</html>
