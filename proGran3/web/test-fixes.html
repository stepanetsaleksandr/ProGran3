<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGran3 - –¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .test-result.pass {
            background-color: #d4edda;
            border-left-color: #28a745;
        }
        .test-result.fail {
            background-color: #f8d7da;
            border-left-color: #dc3545;
        }
        .test-result.info {
            background-color: #d1ecf1;
            border-left-color: #17a2b8;
        }
        .test-result.warning {
            background-color: #fff3cd;
            border-left-color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß –¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å ProGran3</h1>
        <p>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –ø—Ä–æ–±–ª–µ–º –∑ pending –¥–∞–Ω–∏–º–∏, –∫–∞—Ä—É—Å–µ–ª—è–º–∏ —Ç–∞ –ø–∞–Ω–µ–ª—è–º–∏</p>
        
        <div id="test-results"></div>
        
        <button onclick="runTests()" style="
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
        ">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç–∏</button>
    </div>

    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –º–æ–¥—É–ª—ñ -->
    <script src="modules/core/Config.js"></script>
    <script src="modules/core/Logger.js"></script>
    <script src="modules/core/StateManager.js"></script>
    <script src="modules/utils/Helpers.js"></script>
    <script src="modules/utils/Validation.js"></script>
    <script src="modules/utils/Units.js"></script>
    <script src="modules/communication/SketchUpBridge.js"></script>
    <script src="modules/ui/Tabs.js"></script>
    <script src="modules/ui/Panels.js"></script>
    <script src="modules/ui/SummaryTable.js"></script>
    <script src="modules/builders/FoundationBuilder.js"></script>

    <script>
        function addTestResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function runTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '';
            
            addTestResult('üöÄ –ü–æ—á–∞—Ç–æ–∫ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å...', 'info');
            
            try {
                // –¢–µ—Å—Ç 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–¥—É–ª—ñ–≤
                if (window.ProGran3 && window.ProGran3.Communication && window.ProGran3.Communication.SketchUpBridge) {
                    addTestResult('‚úÖ SketchUpBridge –º–æ–¥—É–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'pass');
                } else {
                    addTestResult('‚ùå SketchUpBridge –º–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'fail');
                    return;
                }
                
                if (window.ProGran3 && window.ProGran3.UI && window.ProGran3.UI.Panels) {
                    addTestResult('‚úÖ Panels –º–æ–¥—É–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'pass');
                } else {
                    addTestResult('‚ùå Panels –º–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'fail');
                }
                
                if (window.ProGran3 && window.ProGran3.UI && window.ProGran3.UI.SummaryTable) {
                    addTestResult('‚úÖ SummaryTable –º–æ–¥—É–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'pass');
                } else {
                    addTestResult('‚ùå SummaryTable –º–æ–¥—É–ª—å –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ', 'fail');
                }
                
                // –¢–µ—Å—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü—ñ–π pending preview
                if (typeof window.ProGran3.Communication.SketchUpBridge.addPendingPreview === 'function') {
                    addTestResult('‚úÖ addPendingPreview —Ñ—É–Ω–∫—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞', 'pass');
                } else {
                    addTestResult('‚ùå addPendingPreview —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞', 'fail');
                }
                
                if (typeof window.ProGran3.Communication.SketchUpBridge.receiveWebPreview === 'function') {
                    addTestResult('‚úÖ receiveWebPreview —Ñ—É–Ω–∫—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞', 'pass');
                } else {
                    addTestResult('‚ùå receiveWebPreview —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞', 'fail');
                }
                
                if (typeof window.ProGran3.Communication.SketchUpBridge.handlePreviewError === 'function') {
                    addTestResult('‚úÖ handlePreviewError —Ñ—É–Ω–∫—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞', 'pass');
                } else {
                    addTestResult('‚ùå handlePreviewError —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞', 'fail');
                }
                
                // –¢–µ—Å—Ç 3: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è pending preview —Ñ—É–Ω–∫—Ü—ñ–π
                try {
                    // –¢–µ—Å—Ç—É—î–º–æ addPendingPreview
                    const testElement = document.createElement('div');
                    window.ProGran3.Communication.SketchUpBridge.addPendingPreview('test/path.skp', 'test.skp', 'Test', testElement);
                    addTestResult('‚úÖ addPendingPreview –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫', 'pass');
                    
                    // –¢–µ—Å—Ç—É—î–º–æ receiveWebPreview
                    window.ProGran3.Communication.SketchUpBridge.receiveWebPreview('test/path.skp', 'data:image/png;base64,test');
                    addTestResult('‚úÖ receiveWebPreview –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫', 'pass');
                    
                    // –¢–µ—Å—Ç—É—î–º–æ handlePreviewError
                    window.ProGran3.Communication.SketchUpBridge.handlePreviewError('test/path.skp', 'Test error');
                    addTestResult('‚úÖ handlePreviewError –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫', 'pass');
                    
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—ñ pending preview: ${error.message}`, 'fail');
                }
                
                // –¢–µ—Å—Ç 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–≤–æ—Ä–æ—Ç–Ω–æ—ó —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ
                if (typeof window.receiveWebPreview === 'function') {
                    addTestResult('‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è receiveWebPreview –¥–æ—Å—Ç—É–ø–Ω–∞', 'pass');
                } else {
                    addTestResult('‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è receiveWebPreview –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞', 'fail');
                }
                
                if (typeof window.handlePreviewError === 'function') {
                    addTestResult('‚úÖ –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è handlePreviewError –¥–æ—Å—Ç—É–ø–Ω–∞', 'pass');
                } else {
                    addTestResult('‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è handlePreviewError –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞', 'fail');
                }
                
                // –¢–µ—Å—Ç 5: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è advanceToNextPanel
                try {
                    const testButton = document.createElement('button');
                    const testPanel = document.createElement('div');
                    testPanel.className = 'panel';
                    testPanel.appendChild(testButton);
                    document.body.appendChild(testPanel);
                    
                    // –¢–µ—Å—Ç—É—î–º–æ —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å Panels
                    const result = window.ProGran3.UI.Panels.advanceToNextPanel(testButton);
                    if (typeof result === 'boolean') {
                        addTestResult('‚úÖ advanceToNextPanel –ø—Ä–∞—Ü—é—î —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å Panels', 'pass');
                    } else {
                        addTestResult('‚ö†Ô∏è advanceToNextPanel –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–µ boolean', 'warning');
                    }
                    
                    // –û—á–∏—â–∞—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
                    document.body.removeChild(testPanel);
                    
                } catch (error) {
                    addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—ñ advanceToNextPanel: ${error.message}`, 'fail');
                }
                
                // –¢–µ—Å—Ç 6: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ StateManager —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
                if (window.ProGran3.Core.StateManager) {
                    try {
                        const testData = { stands: ['test1.skp', 'test2.skp'] };
                        const result = window.ProGran3.Core.StateManager.setModelLists(testData);
                        if (result) {
                            addTestResult('‚úÖ StateManager setModelLists –ø—Ä–∞—Ü—é—î', 'pass');
                        } else {
                            addTestResult('‚ùå StateManager setModelLists –Ω–µ –ø—Ä–∞—Ü—é—î', 'fail');
                        }
                    } catch (error) {
                        addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ StateManager: ${error.message}`, 'fail');
                    }
                }
                
                // –¢–µ—Å—Ç 7: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ SummaryTable
                if (window.ProGran3.UI.SummaryTable) {
                    try {
                        window.ProGran3.UI.SummaryTable.updateSummaryTable();
                        addTestResult('‚úÖ SummaryTable updateSummaryTable –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–æ–º–∏–ª–æ–∫', 'pass');
                    } catch (error) {
                        addTestResult(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ SummaryTable: ${error.message}`, 'fail');
                    }
                }
                
                addTestResult('üèÅ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–æ!', 'info');
                addTestResult('‚úÖ –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ!', 'pass');
                
            } catch (error) {
                addTestResult(`‚ùå –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –≤ —Ç–µ—Å—Ç—ñ: ${error.message}`, 'fail');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>
