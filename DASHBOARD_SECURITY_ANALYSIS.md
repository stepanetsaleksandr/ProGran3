# üîê –ê–ù–ê–õ–Ü–ó –ë–ï–ó–ü–ï–ö–ò –î–ê–®–ë–û–†–î–£ PROGRAN3

**–î–∞—Ç–∞:** 25 –∂–æ–≤—Ç–Ω—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞—à–±–æ—Ä–¥ –Ω–µ –∑–∞—Ö–∏—â–µ–Ω–∏–π –ª–æ–≥—ñ–Ω–æ–º  
**–°—Ç–∞—Ç—É—Å:** üö® –ö–†–ò–¢–ò–ß–ù–ê –í–†–ê–ó–õ–ò–í–Ü–°–¢–¨

---

## üö® –ü–û–¢–û–ß–ù–ê –ü–†–û–ë–õ–ï–ú–ê

### **–ö—Ä–∏—Ç–∏—á–Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å:**
```
‚ùå –î–ê–®–ë–û–†–î –î–û–°–¢–£–ü–ù–ò–ô –ë–ï–ó –ê–£–¢–ï–ù–¢–ò–§–Ü–ö–ê–¶–Ü–á
URL: https://server-9mthuudy4-provis3ds-projects.vercel.app/
```

**–†–∏–∑–∏–∫–∏:**
- üî¥ **–ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø** –¥–æ –≤—Å—ñ—Ö –ª—ñ—Ü–µ–Ω–∑—ñ–π
- üî¥ **–í–∏–¥–∞–ª–µ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ–π** –±–µ–∑ –¥–æ–∑–≤–æ–ª—É
- üî¥ **–ü–µ—Ä–µ–≥–ª—è–¥ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–∏—Ö –¥–∞–Ω–∏—Ö** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- üî¥ **–ú–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—è —Å–∏—Å—Ç–µ–º–æ—é** –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º–∏

---

## üîç –ê–ù–ê–õ–Ü–ó –ü–û–¢–û–ß–ù–û–á –°–¢–†–£–ö–¢–£–†–ò

### **1. –ü–æ—Ç–æ—á–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENT SIDE                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Dashboard  ‚îÇ  ‚îÇ   Hooks      ‚îÇ  ‚îÇ   Components    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ page.tsx   ‚îÇ  ‚îÇ ‚Ä¢ useStats   ‚îÇ  ‚îÇ ‚Ä¢ LicenseMgr   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ layout.tsx ‚îÇ  ‚îÇ ‚Ä¢ useLicenses‚îÇ  ‚îÇ ‚Ä¢ SystemMonitor ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ globals.css‚îÇ  ‚îÇ ‚Ä¢ getAuthToken‚îÇ  ‚îÇ ‚Ä¢ Tabs          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                 ‚îÇ                                ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                           ‚îÇ HTTP Requests (NO AUTH!)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SERVER SIDE                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   API Routes   ‚îÇ  ‚îÇ   Middleware   ‚îÇ  ‚îÇ  Database    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ                ‚îÇ  ‚îÇ              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ /api/licenses‚îÇ  ‚îÇ ‚Ä¢ CORS         ‚îÇ  ‚îÇ ‚Ä¢ Supabase   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ /api/stats   ‚îÇ  ‚îÇ ‚Ä¢ Headers      ‚îÇ  ‚îÇ ‚Ä¢ PostgreSQL ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ /api/auth    ‚îÇ  ‚îÇ ‚Ä¢ Logging      ‚îÇ  ‚îÇ ‚Ä¢ RLS        ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ           ‚îÇ                                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ              NO AUTHENTICATION!                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ              ‚ùå –ü–£–ë–õ–Ü–ß–ù–ò–ô –î–û–°–¢–£–ü                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **2. –ü—Ä–æ–±–ª–µ–º–Ω—ñ –º—ñ—Å—Ü—è:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–æ–±–ª–µ–º–∞ | –†–∏–∑–∏–∫ |
|-----------|----------|-------|
| **`/` (page.tsx)** | –ü—Ä—è–º–∏–π –¥–æ—Å—Ç—É–ø –¥–æ Dashboard | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–∏–π |
| **`/api/licenses`** | –ù–µ–º–∞—î –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–∏–π |
| **`/api/dashboard/stats`** | –¢—ñ–ª—å–∫–∏ API Key (–ª–µ–≥–∫–æ –æ–±—ñ–π—Ç–∏) | üü° –í–∏—Å–æ–∫–∏–π |
| **`useDashboardStats`** | –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–æ–∫–µ–Ω—É | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–∏–π |
| **`useLicenses`** | JWT —Ç–æ–∫–µ–Ω, –∞–ª–µ –±–µ–∑ –∑–∞—Ö–∏—Å—Ç—É UI | üü° –í–∏—Å–æ–∫–∏–π |

---

## üí° –í–ê–†–Ü–ê–ù–¢–ò –†–Ü–®–ï–ù–ù–Ø

### **üéØ –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–ò–ô –ü–Ü–î–•–Ü–î: Next.js Middleware + JWT**

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏
- ‚úÖ **–ë–µ–∑–ø–µ–∫–∞**: Server-side –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
- ‚úÖ **UX**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –õ–µ–≥–∫–æ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏

---

## üõ†Ô∏è –ü–õ–ê–ù –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á

### **–ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è Login —Å—Ç–æ—Ä—ñ–Ω–∫–∏**

```typescript
// app/login/page.tsx
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';

export default function LoginPage() {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();

      if (data.success) {
        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–æ–∫–µ–Ω
        localStorage.setItem('admin_token', data.data.token);
        localStorage.setItem('admin_token_expiry', 
          (Date.now() + data.data.expires_in * 1000).toString()
        );
        
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –¥–∞—à–±–æ—Ä–¥
        router.push('/');
      } else {
        setError(data.error || 'Login failed');
      }
    } catch (err) {
      setError('Network error');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
      <div className="max-w-md w-full space-y-8">
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">
            ProGran3 Admin
          </h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            –í–≤–µ–¥—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è –¥–æ—Å—Ç—É–ø—É
          </p>
        </div>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <div>
            <label htmlFor="username" className="sr-only">
              Username
            </label>
            <input
              id="username"
              name="username"
              type="text"
              required
              className="relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              placeholder="Username"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
            />
          </div>
          <div>
            <label htmlFor="password" className="sr-only">
              Password
            </label>
            <input
              id="password"
              name="password"
              type="password"
              required
              className="relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              placeholder="Password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />
          </div>

          {error && (
            <div className="text-red-600 text-sm text-center">{error}</div>
          )}

          <div>
            <button
              type="submit"
              disabled={loading}
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"
            >
              {loading ? '–í—Ö—ñ–¥...' : '–£–≤—ñ–π—Ç–∏'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}
```

### **–ö—Ä–æ–∫ 2: –û–Ω–æ–≤–ª–µ–Ω–Ω—è Middleware**

```typescript
// middleware.ts
import { NextRequest, NextResponse } from 'next/server';
import { validateToken } from '@/lib/auth';

export function middleware(request: NextRequest) {
  const response = NextResponse.next();

  // Security Headers (—ñ—Å–Ω—É—é—á—ñ)
  response.headers.set('X-Frame-Options', 'DENY');
  response.headers.set('X-Content-Type-Options', 'nosniff');
  response.headers.set('X-XSS-Protection', '1; mode=block');
  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');

  // ‚úÖ –ù–û–í–ê –õ–û–ì–Ü–ö–ê: –ó–∞—Ö–∏—Å—Ç –¥–∞—à–±–æ—Ä–¥—É
  if (request.nextUrl.pathname === '/') {
    const token = request.cookies.get('admin_token')?.value;
    
    if (!token) {
      // –ù–µ–º–∞—î —Ç–æ–∫–µ–Ω—É - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –ª–æ–≥—ñ–Ω
      return NextResponse.redirect(new URL('/login', request.url));
    }

    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç–æ–∫–µ–Ω
    const authResult = validateToken(token);
    if (!authResult.valid) {
      // –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª—ñ–¥–Ω–∏–π - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –Ω–∞ –ª–æ–≥—ñ–Ω
      return NextResponse.redirect(new URL('/login', request.url));
    }
  }

  // –ó–∞—Ö–∏—Å—Ç API endpoints
  if (request.nextUrl.pathname.startsWith('/api/')) {
    // –ü—É–±–ª—ñ—á–Ω—ñ endpoints (–Ω–µ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó)
    const publicEndpoints = [
      '/api/licenses/activate',
      '/api/licenses/validate', 
      '/api/heartbeats',
      '/api/systems',
      '/api/auth/login'
    ];

    const isPublic = publicEndpoints.some(endpoint => 
      request.nextUrl.pathname.startsWith(endpoint)
    );

    if (!isPublic) {
      // –ó–∞—Ö–∏—â–µ–Ω—ñ endpoints - –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é
      const authHeader = request.headers.get('Authorization');
      const apiKey = request.headers.get('X-API-Key');
      
      if (!authHeader && !apiKey) {
        return new NextResponse(
          JSON.stringify({ success: false, error: 'Authentication required' }),
          { status: 401, headers: { 'Content-Type': 'application/json' } }
        );
      }
    }
  }

  // CORS –¥–ª—è API (—ñ—Å–Ω—É—é—á–∞ –ª–æ–≥—ñ–∫–∞)
  if (request.nextUrl.pathname.startsWith('/api/')) {
    const allowedOrigins = [
      'https://app.sketchup.com',
      'https://www.sketchup.com',
      'https://localhost:3000',
      'https://127.0.0.1:3000'
    ];
    
    const origin = request.headers.get('origin');
    if (allowedOrigins.includes(origin || '')) {
      response.headers.set('Access-Control-Allow-Origin', origin || '');
    }
    
    response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
    response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-API-Key');
    response.headers.set('Access-Control-Max-Age', '86400');

    if (request.method === 'OPTIONS') {
      return new NextResponse(null, { status: 200, headers: response.headers });
    }
  }

  return response;
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
};
```

### **–ö—Ä–æ–∫ 3: Auth Context –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞**

```typescript
// app/context/AuthContext.tsx
'use client';

import { createContext, useContext, useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';

interface AuthContextType {
  isAuthenticated: boolean;
  isLoading: boolean;
  login: (username: string, password: string) => Promise<boolean>;
  logout: () => void;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
    const token = localStorage.getItem('admin_token');
    const expiry = localStorage.getItem('admin_token_expiry');
    
    if (token && expiry && parseInt(expiry) > Date.now()) {
      setIsAuthenticated(true);
    } else {
      // –¢–æ–∫–µ–Ω –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π –∞–±–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ–π
      localStorage.removeItem('admin_token');
      localStorage.removeItem('admin_token_expiry');
      setIsAuthenticated(false);
    }
    
    setIsLoading(false);
  }, []);

  const login = async (username: string, password: string): Promise<boolean> => {
    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });

      const data = await response.json();

      if (data.success) {
        localStorage.setItem('admin_token', data.data.token);
        localStorage.setItem('admin_token_expiry', 
          (Date.now() + data.data.expires_in * 1000).toString()
        );
        setIsAuthenticated(true);
        return true;
      }
      
      return false;
    } catch {
      return false;
    }
  };

  const logout = () => {
    localStorage.removeItem('admin_token');
    localStorage.removeItem('admin_token_expiry');
    setIsAuthenticated(false);
    router.push('/login');
  };

  return (
    <AuthContext.Provider value={{ isAuthenticated, isLoading, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

### **–ö—Ä–æ–∫ 4: –û–Ω–æ–≤–ª–µ–Ω–Ω—è Layout**

```typescript
// app/layout.tsx
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'
import { AuthProvider } from './context/AuthContext'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'ProGran3 Server',
  description: 'ProGran3 License Management Server',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <AuthProvider>
          {children}
        </AuthProvider>
      </body>
    </html>
  )
}
```

### **–ö—Ä–æ–∫ 5: –û–Ω–æ–≤–ª–µ–Ω–Ω—è Dashboard –∑ Logout**

```typescript
// app/components/Dashboard.tsx (–¥–æ–¥–∞—Ç–∏ logout –∫–Ω–æ–ø–∫—É)
'use client';

import { useAuth } from '../context/AuthContext';
// ... —ñ—Å–Ω—É—é—á—ñ —ñ–º–ø–æ—Ä—Ç–∏

function DashboardContent() {
  const { logout } = useAuth();
  // ... —ñ—Å–Ω—É—é—á–∏–π –∫–æ–¥

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <div className="flex justify-between items-start">
            <div>
              <h1 className="text-3xl font-bold text-gray-900">ProGran3 Dashboard</h1>
              <p className="mt-2 text-gray-600">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ª—ñ—Ü–µ–Ω–∑—ñ—è–º–∏ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º</p>
            </div>
            <div className="flex gap-2">
              <button
                onClick={refreshStats}
                className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 flex items-center gap-2"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                –û–Ω–æ–≤–∏—Ç–∏
              </button>
              <button
                onClick={logout}
                className="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 flex items-center gap-2"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                –í–∏–π—Ç–∏
              </button>
            </div>
          </div>
        </div>
        {/* ... —Ä–µ—à—Ç–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É */}
      </div>
    </div>
  );
}
```

---

## üéØ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–Ü –ü–Ü–î–•–û–î–ò

### **–í–∞—Ä—ñ–∞–Ω—Ç 1: Session-based Authentication**

```typescript
// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è NextAuth.js
import NextAuth from 'next-auth'
import CredentialsProvider from 'next-auth/providers/credentials'

export default NextAuth({
  providers: [
    CredentialsProvider({
      name: 'credentials',
      credentials: {
        username: { label: 'Username', type: 'text' },
        password: { label: 'Password', type: 'password' }
      },
      async authorize(credentials) {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ credentials
        if (credentials?.username === 'admin' && credentials?.password === 'admin123') {
          return { id: '1', name: 'Admin', email: 'admin@progran3.com' }
        }
        return null
      }
    })
  ],
  pages: {
    signIn: '/login',
  },
  callbacks: {
    async jwt({ token, user }) {
      if (user) token.user = user
      return token
    },
    async session({ session, token }) {
      session.user = token.user
      return session
    }
  }
})
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å–µ—Å—ñ—è–º–∏
- ‚úÖ –í–±—É–¥–æ–≤–∞–Ω—ñ —Ö—É–∫–∏

**–ù–µ–¥–æ–ª—ñ–∫–∏:**
- ‚ö†Ô∏è –î–æ–¥–∞—Ç–∫–æ–≤–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å
- ‚ö†Ô∏è –ë—ñ–ª—å—à–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

### **–í–∞—Ä—ñ–∞–Ω—Ç 2: HTTP Basic Auth**

```typescript
// middleware.ts
import { NextRequest, NextResponse } from 'next/server';

export function middleware(request: NextRequest) {
  const response = NextResponse.next();
  
  if (request.nextUrl.pathname === '/') {
    const authHeader = request.headers.get('authorization');
    
    if (!authHeader || !authHeader.startsWith('Basic ')) {
      return new NextResponse('Authentication required', {
        status: 401,
        headers: {
          'WWW-Authenticate': 'Basic realm="ProGran3 Admin"'
        }
      });
    }
    
    const credentials = Buffer.from(authHeader.slice(6), 'base64').toString();
    const [username, password] = credentials.split(':');
    
    if (username !== 'admin' || password !== 'admin123') {
      return new NextResponse('Invalid credentials', { status: 401 });
    }
  }
  
  return response;
}
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –ø—ñ–¥—Ö—ñ–¥
- ‚úÖ –í–±—É–¥–æ–≤–∞–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –∫–æ–¥

**–ù–µ–¥–æ–ª—ñ–∫–∏:**
- ‚ö†Ô∏è –ú–µ–Ω—à –≥–Ω—É—á–∫–∏–π
- ‚ö†Ô∏è –ù–µ–º–∞—î logout —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—ñ
- ‚ö†Ô∏è Credentials –≤ URL

---

## üèÜ –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–Ø

### **üéØ –ù–ê–ô–ö–†–ê–©–ò–ô –ü–Ü–î–•–Ü–î: JWT + Middleware**

**–ß–æ–º—É —Å–∞–º–µ —Ü–µ–π –ø—ñ–¥—Ö—ñ–¥:**

1. **‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–∏ –≤ —ñ—Å–Ω—É—é—á–æ–º—É –∫–æ–¥—ñ
2. **‚úÖ –ë–µ–∑–ø–µ–∫–∞**: Server-side –≤–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤
3. **‚úÖ UX**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è + logout
4. **‚úÖ –ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ —Ä–æ–ª—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏
5. **‚úÖ –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å**: –ü—Ä–∞—Ü—é—î –∑ —ñ—Å–Ω—É—é—á–æ—é JWT —Å–∏—Å—Ç–µ–º–æ—é

### **–ü–ª–∞–Ω –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è:**

1. **–î–µ–Ω—å 1**: –°—Ç–≤–æ—Ä–∏—Ç–∏ login —Å—Ç–æ—Ä—ñ–Ω–∫—É + AuthContext
2. **–î–µ–Ω—å 2**: –û–Ω–æ–≤–∏—Ç–∏ middleware –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É
3. **–î–µ–Ω—å 3**: –î–æ–¥–∞—Ç–∏ logout —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
4. **–î–µ–Ω—å 4**: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è + –¥–µ–ø–ª–æ–π

### **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
üîê –ó–ê–•–ò–©–ï–ù–ò–ô –î–ê–®–ë–û–†–î
‚îú‚îÄ‚îÄ /login - –°—Ç–æ—Ä—ñ–Ω–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
‚îú‚îÄ‚îÄ / - –ó–∞—Ö–∏—â–µ–Ω–∏–π –¥–∞—à–±–æ—Ä–¥ (—Ç—ñ–ª—å–∫–∏ –∑ —Ç–æ–∫–µ–Ω–æ–º)
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
‚îú‚îÄ‚îÄ Logout —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
‚îî‚îÄ‚îÄ Server-side –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
```

---

**–°—Ç–∞—Ç—É—Å:** üü° –ì–û–¢–û–í–û –î–û –†–ï–ê–õ–Ü–ó–ê–¶–Ü–á  
**–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:** üü¢ –ü–†–û–°–¢–ê (2-3 –¥–Ω—ñ)  
**–ë–µ–∑–ø–µ–∫–∞:** üü¢ –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê
